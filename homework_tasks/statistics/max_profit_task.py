"""
Пусть прибыль в вашей компании выражается следующей функцией,
которая зависит от параметра  — количества производимых товаров:

f(x) = -x**4 + 6*x**3 - 4*x**2 + 80

Найдите максимально возможную прибыль, которую вы можете получить, варьируя количество произведенных товаров.
"""
# Импортируем нужные функции из sympy
# symbols — для задания переменных,
# diff — для вычисления производных,
# solve — для решения уравнений,
# factor и N — для упрощения и численного вычисления
from sympy import symbols, diff, solve, factor, N

# 1️⃣ Задаем символическую переменную x (количество произведенных товаров),
# real=True - только вещественные числа, без комплексных
x = symbols('x', real=True)

# 2️⃣ Определяем функцию прибыли f(x)
# Формула дана в условии: f(x) = -x^4 + 6x^3 - 4x^2 + 80
f = -x ** 4 + 6 * x ** 3 - 4 * x ** 2 + 80

# 3️⃣ Находим первую производную df/dx
# Она показывает, как быстро изменяется прибыль при изменении количества товара
fx = diff(f, x)
print(f"Первая производная f'(x): {fx}")

# 4️⃣ Приравниваем производную к нулю и находим критические точки (экстремумы)
# Эти точки — кандидаты на максимум или минимум прибыли
sols = solve(fx, x)
print(f"Критические точки (f'(x)=0): {sols}")

# 5️⃣ Находим вторую производную f''(x)
# Она нужна, чтобы определить характер точки:
# если f''(x)<0 — максимум, если f''(x)>0 — минимум
fxx = diff(fx, x)
print(f"Вторая производная f''(x): {fxx}")

# 6️⃣ Для каждой найденной точки вычисляем:
# - значение второй производной (знак определяет тип экстремума)
# - значение функции f(x) (прибыль в этой точке)
vals = [(xi, fxx.subs(x, xi), f.subs(x, xi)) for xi in sols]

print("\nРезультаты анализа по точкам:")
for xi, f2, fv in vals:
    # Определяем тип точки по знаку второй производной
    if f2 < 0:
        kind = "локальный максимум"
    elif f2 > 0:
        kind = "локальный минимум"
    else:
        kind = "неопределено"

    # Выводим все красиво
    print(f"x = {xi}, f''(x) = {f2}, f(x) = {fv} ≈ {N(fv)}, {kind}")

# 7️⃣ Находим, где прибыль максимальна
# Используем функцию max по значению f(x)
best_x = max(sols, key=lambda t: f.subs(x, t))
max_profit = f.subs(x, best_x)

print(f"\nГлобальный максимум прибыли: f({best_x}) = {max_profit}")
