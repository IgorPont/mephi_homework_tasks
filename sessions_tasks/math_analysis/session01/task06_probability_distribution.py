"""
Задание 6. Распределение вероятностей (без готовых функций Python).

    Дано распределение количества полученных спам-писем за день:

    Количество писем:   0    1    2     3     4     5    6    7
    Вероятности:      0.1  0.3  0.1  0.25  0.05  0.05  0.1    ?

    1) Найти вероятность получения 7 писем.
    2) Найти математическое ожидание (E[X]).
    3) Найти дисперсию (D[X]).
    Округлить ответы до сотых.

Запуск:
    poetry run python -m homework_tasks.sessions_tasks.math_analysis.session01.task06_probability_distribution

Пример результата вывода после запуска:

    ================== ЗАДАНИЕ 6 - Распределение ==================
    Таблица вероятностей (x_i | p_i):
       0 | 0.10
       1 | 0.30
       2 | 0.10
       3 | 0.25
       4 | 0.05
       5 | 0.05
       6 | 0.10
       7 | 0.05
    ---------------------------------------------------------------
    1) Вероятность получить 7 писем: p(7) = 0.05
    2) Математическое ожидание: E[X] = 2.65
    3) Дисперсия: D[X] = 4.03
    ===============================================================
"""


def main() -> None:
    """
    Пошаговое решение:
        1. Находим недостающую вероятность (вероятности в сумме = 1)
        2. Считаем математическое ожидание E[X] = sum(x_i * p_i)
        3. Считаем дисперсию D[X] = sum((x_i - E[X])^2 * p_i)
    """

    # Значения случайной величины (количество писем)
    x = [0, 1, 2, 3, 4, 5, 6, 7]

    # Известные вероятности (для 7 случайной величины вероятность неизвестна)
    p = [0.1, 0.3, 0.1, 0.25, 0.05, 0.05, 0.1, None]

    # 1) Проверяем корректность и находим недостающую вероятность
    sum_known = sum(v for v in p if v is not None)
    missing = 1 - sum_known

    # Проверка: сумма вероятностей не должна превышать 1
    if missing < 0:
        raise ValueError(
            f"Ошибка: сумма известных вероятностей превышает 1 (сумма = {sum_known:.2f})."
        )

    # Округляем до сотых и записываем вероятность для 7 писем
    p[7] = round(missing, 2)

    # 2) Математическое ожидание (E[X])
    expected_value = 0
    for xi, pi in zip(x, p):
        expected_value += xi * pi

    # 3) Дисперсия (D[X]) = sum((x_i - E[X])^2 * p_i)
    variance = 0
    for xi, pi in zip(x, p):
        variance += ((xi - expected_value) ** 2) * pi

    # Округляем результаты до сотых
    expected_value = round(expected_value, 2)
    variance = round(variance, 2)

    # 4) Вывод
    print("\n================== ЗАДАНИЕ 6 - Распределение ==================")
    print("Таблица вероятностей (x_i | p_i):")
    for xi, pi in zip(x, p):
        print(f"  {xi:>2} | {pi:.2f}")
    print("---------------------------------------------------------------")
    print(f"1) Вероятность получить 7 писем: p(7) = {p[7]:.2f}")
    print(f"2) Математическое ожидание: E[X] = {expected_value:.2f}")
    print(f"3) Дисперсия: D[X] = {variance:.2f}")
    print("===============================================================\n")


if __name__ == "__main__":
    main()
